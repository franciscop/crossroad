import e,{createContext as t,useContext as r,useState as n,useEffect as o}from"react";const s=e=>{if("string"!=typeof e)return e;const t={},r=new URL(e,"https://example.com/");var n;(t.path=r.pathname.replace(/\/$/,"")||"/",r.hash)&&(t.hash=null===(n=r.hash)||void 0===n?void 0:n.replace(/^#/,""));t.query={};for(const[e,n]of r.searchParams)t.query[e]=n;return t};function i(e,t,r={}){if(e=JSON.parse(JSON.stringify(s(e))),(t=JSON.parse(JSON.stringify(s(t)))).path.endsWith("/")&&(t.path=t.path.slice(0,-1)||"/"),e.path.endsWith("/")&&(e.path=e.path.slice(0,-1)||"/"),e.path.endsWith("*")){e.path=e.path.replace(/\/?\*/,"")||"/";const r=e.path.slice(1).split("/").filter(Boolean).length;t.path="/"+t.path.slice(1).split("/").slice(0,r).join("/")}if(Object.entries(e.query).length)for(let r in e.query){if(!(r in t.query))return!1;if(e.query[r]&&e.query[r]!==t.query[r])return!1}if(t.path===e.path)return!0;if(!e.path.includes(":"))return e.path===t.path;if(e.path.split("/").length!==t.path.split("/").length)return!1;const n={},o=e.path.split("/").every((e,r)=>{const o=t.path.split("/")[r];return e.startsWith(":")?(n[e.slice(1)]=o,!0):o===e});return o&&Object.assign(r,n),o}var a=t();const h=()=>{const e=r(a);if(!e)throw new Error("Hooks should be used as children of <Router>");return e},p=()=>{const[e,t]=h();return[e.path,(r,n)=>t({...e,path:r},n)]},l=e=>{const[t,r]=h(),n=t.query,o=(e,n)=>r({...t,query:e},n);return e?[n[e],(t,r)=>o({...n,[e]:t},r)]:[n,o]},c=()=>{const[e,t]=h();return[e.hash,(r,n)=>t({...e,hash:r},n)]},u=e=>{const[t]=p(),r={};return i(e,t,r),r},d=({path:t="*",exact:r=!0,component:n,render:o,children:s})=>{const[a,p]=h(),l={};if(!i(t,a,l))return null;if(n){const t=n;return e.createElement(t,l)}if(o)return o(l);if(s)return s;throw new Error("Route needs the prop `component`, `render` or `children`")},f=({redirect:e,children:t})=>{const[r,n]=h(),s=(e=>e?Array.isArray(e)?[...e]:[e]:[])(t).find(e=>i(e.props.path||"*",r))||null;return o(()=>{e&&!s&&n(e)},[e,Boolean(s)]),s};export default({children:t})=>{const[r,i]=n(s(window.location.href)),h=(e,t={mode:"push"})=>{"string"==typeof e&&(e=s(e));const r=(({path:e,query:t,hash:r}={})=>{let n=e||"/";return t&&Object.keys(t).length&&(n+="?",n+=Object.entries(t).map(([e,t])=>e+"="+encodeURIComponent(t)).join("&")),r&&(n+="#"+r),n})(e);if(!["push","replace"].includes(t.mode))throw new Error(`Unrecognized mode "${t.mode}"`);"replace"===t.mode?history.replaceState({},null,r):history.pushState({},null,r),i(e)};return o(()=>{const e=e=>i(s(window.location.href)),t=e=>{const t=(e=>{if(!e)return null;const t=e.getAttribute("href");return t?/^https?:\/\//.test(t)||null!==e.getAttribute("target")?null:t:null})(e.target.closest("a"));t&&(e.preventDefault(),h(t))};return window.addEventListener("popstate",e),document.addEventListener("click",t),()=>{window.removeEventListener("popstate",e),document.removeEventListener("click",t)}},[]),e.createElement(a.Provider,{value:[r,h]},t)};export{a as Context,d as Route,f as Switch,c as useHash,u as useParams,p as usePath,l as useQuery,h as useUrl};
