import t,{createContext as e,useContext as r,useState as n,useEffect as a}from"react";const s=t=>{if("string"!=typeof t)return t;const e={},r=new URL(t,"http://localhost:3000/");e.path=r.pathname.replace(/\/$/,"")||"/",e.query={};for(const[t]of r.searchParams)e.query[t]=(n=r.searchParams.getAll(t)).length>1?n:n[0];var n;return r.hash&&(e.hash=r.hash.replace(/^#/,"")),e},i=t=>{if("string"==typeof t)return t;const{path:e,query:r={},hash:n}=t||{};let a=e||"/";const s=new URLSearchParams(Object.entries(r).map(([t,e])=>(e.map?e:[e]).map(e=>[t,e])).flat()).toString();return s&&(a+="?"+s),n&&(a+="#"+n),a};function o(t,e,r={}){if(t=JSON.parse(JSON.stringify(s(t))),(e=JSON.parse(JSON.stringify(s(e)))).path.endsWith("/")&&(e.path=e.path.slice(0,-1)||"/"),t.path.endsWith("/")&&(t.path=t.path.slice(0,-1)||"/"),t.path.endsWith("*")){t.path=t.path.replace(/\/?\*/,"")||"/";const r=t.path.slice(1).split("/").filter(Boolean).length;e.path="/"+e.path.slice(1).split("/").slice(0,r).join("/")}if(Object.entries(t.query).length)for(let r in t.query){if(!(r in e.query))return!1;if(t.query[r]&&t.query[r]!==e.query[r])return!1}if(e.path===t.path)return r;if(!t.path.includes(":"))return t.path===e.path&&r;if(t.path.split("/").length!==e.path.split("/").length)return!1;const n={},a=t.path.split("/").every((t,a)=>{const s=e.path.split("/")[a];return t.startsWith(":")?(n[t.slice(1)]=s,r):s===t});return a&&Object.assign(r,n),a&&r}var p=e();const h=()=>{const t=r(p);if(!t)throw new Error("Wrap your App with <Router>");return t},l=()=>{const[t,e]=h();return[t.path,(r,n)=>e({...t,path:r},n)]},c=t=>{const[e,r]=h(),n=e.query,a=(t,n)=>r({...e,query:t},n);return t?[n[t],(e,r)=>a({...n,[t]:e},r)]:[n,a]},u=()=>{const[t,e]=h();return[t.hash,(r,n)=>e({...t,hash:r},n)]},f=t=>{const e=r(p),[n]=l();if(t){const e={};return o(t,n,e),e}return e[0].params},d=()=>"undefined"==typeof window,y=({path:e="*",exact:n=!0,component:a,render:s,children:i})=>{const h=r(p),l=o(e,h[0]);if(!l)return null;if(a){const e=a;i=t.createElement(e,l)}else if(s)i=s(l);else if(!i)throw new Error("Route needs prop `component`, `render` or `children`");return t.createElement(p.Provider,{value:[{...h[0],params:l},...h.slice(1)]},i)},m=({redirect:t,children:e})=>{const[r,n]=h(),s=(t=>(Array.isArray(t)||(t=[t]),t.filter(t=>t&&t.props)))(e).find(t=>o(t.props.path||"*",r))||null;return a(()=>{t&&(s||("function"==typeof t&&(t=t(r)),n(i(t))))},[t,s]),s};export default({url:e,children:r})=>{const o=e||(d()?"/":window.location.href),[h,l]=n(()=>s(o)),c=(t,{mode:e="push"}={})=>{if(!history[e+"State"])throw new Error(`Invalid mode "${e}"`);history[e+"State"]({},null,i(t)),l(s(t))};return a(()=>{if(d())return;const t=()=>c(window.location.href),e=t=>{const e=(t=>{if(!t)return null;const e=t.getAttribute("href");return e?/^https?:\/\//.test(e)||null!==t.getAttribute("target")?null:e:null})(t.target.closest("a"));e&&(t.preventDefault(),c(e))};return window.addEventListener("popstate",t),document.addEventListener("click",e),()=>{window.removeEventListener("popstate",t),document.removeEventListener("click",e)}},[]),t.createElement(p.Provider,{value:[h,c]},r)};export{p as Context,y as Route,m as Switch,u as useHash,f as useParams,l as usePath,c as useQuery,h as useUrl};
