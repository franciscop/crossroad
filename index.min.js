import e,{createContext as t,useContext as r,useState as n,useEffect as o}from"react";const s=e=>{if("string"!=typeof e)return e;const t={},r=new URL(e,"https://example.com/");var n;(t.path=r.pathname.replace(/\/$/,"")||"/",r.hash)&&(t.hash=null===(n=r.hash)||void 0===n?void 0:n.replace(/^#/,""));t.query={};for(const[e,n]of r.searchParams)t.query[e]=n;return t};function i(e,t,r={}){if(e=JSON.parse(JSON.stringify(s(e))),(t=JSON.parse(JSON.stringify(s(t)))).path.endsWith("/")&&(t.path=t.path.slice(0,-1)||"/"),e.path.endsWith("/")&&(e.path=e.path.slice(0,-1)||"/"),e.path.endsWith("*")){e.path=e.path.replace(/\/?\*/,"")||"/";const r=e.path.slice(1).split("/").filter(Boolean).length;t.path="/"+t.path.slice(1).split("/").slice(0,r).join("/")}if(Object.entries(e.query).length)for(let r in e.query){if(!(r in t.query))return!1;if(e.query[r]&&e.query[r]!==t.query[r])return!1}return t.path===e.path||(e.path.includes(":")?e.path.split("/").length===t.path.split("/").length&&e.path.split("/").every((e,n)=>{const o=t.path.split("/")[n];return e.startsWith(":")?(r[e.slice(1)]=o,!0):o===e}):e.path===t.path)}var a=t();const h=()=>{const e=r(a);if(!e)throw new Error("Hooks should be used as children of <Router>");return e},p=()=>{const[e,t]=h();return[e.path,(r,n)=>t({...e,path:r},n)]},c=e=>{const[t,r]=h(),n=t.query,o=(e,n)=>r({...t,query:e},n);return e?[n[e],(t,r)=>o({...n,[e]:t},r)]:[n,o]},l=()=>{const[e,t]=h();return[e.hash,(r,n)=>t({...e,hash:r},n)]},u=({path:t="*",exact:r=!0,component:n,render:o,children:s})=>{const[a,p]=h(),c={};if(!i(t,a,c))return null;if(n){const t=n;return e.createElement(t,c)}if(o)return o(c);if(s)return s;throw new Error("Route needs the prop `component`, `render` or `children`")},d=({children:e})=>{const[t]=h();if(!e)return null;Array.isArray(e)||(e=[e]);if([...e].find(({props:e})=>!e.path&&!e.to))throw new Error("<Switch> only accepts <Route> or <Redirect> as children");return e.find(({props:e})=>i(e.path,t))};export default({children:t})=>{const[r,i]=n(s(window.location.href)),h=(e,t={mode:"push"})=>{"string"==typeof e&&(e=s(e));const r=(({path:e,query:t,hash:r}={})=>{let n=e||"/";return t&&Object.keys(t).length&&(n+="?",n+=Object.entries(t).map(([e,t])=>e+"="+encodeURIComponent(t)).join("&")),r&&(n+="#"+r),n})(e);if(!["push","replace"].includes(t.mode))throw new Error(`Unrecognized mode "${t.mode}"`);"replace"===t.mode?history.replaceState({},null,r):history.pushState({},null,r),i(e)};return o(()=>{window.onpopstate=e=>i(s(window.location.href));const e=e=>{const t=e.target.closest("a");if(!t)return;const r=t.getAttribute("href");r&&(/^https?:\/\//.test(r)||null===t.getAttribute("target")&&(e.preventDefault(),h(r)))};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),e.createElement(a.Provider,{value:[r,h]},t)};export{u as Route,a as RouterContext,d as Switch,l as useHash,p as usePath,c as useQuery,h as useUrl};
