import t,{createContext as e,useContext as r,useState as n,useEffect as o}from"react";const s=t=>{if("string"!=typeof t)return t;const e={},r=new URL(t,"https://example.com/");var n;(e.path=r.pathname.replace(/\/$/,"")||"/",r.hash)&&(e.hash=null===(n=r.hash)||void 0===n?void 0:n.replace(/^#/,""));e.query={};for(const[t,n]of r.searchParams)e.query[t]=n;return e};function i(t,e,r={}){if(t=JSON.parse(JSON.stringify(s(t))),(e=JSON.parse(JSON.stringify(s(e)))).path.endsWith("/")&&(e.path=e.path.slice(0,-1)||"/"),t.path.endsWith("/")&&(t.path=t.path.slice(0,-1)||"/"),t.path.endsWith("*")){t.path=t.path.replace(/\/?\*/,"")||"/";const r=t.path.slice(1).split("/").filter(Boolean).length;e.path="/"+e.path.slice(1).split("/").slice(0,r).join("/")}if(Object.entries(t.query).length)for(let r in t.query){if(!(r in e.query))return!1;if(t.query[r]&&t.query[r]!==e.query[r])return!1}if(e.path===t.path)return!0;if(!t.path.includes(":"))return t.path===e.path;if(t.path.split("/").length!==e.path.split("/").length)return!1;const n={},o=t.path.split("/").every((t,r)=>{const o=e.path.split("/")[r];return t.startsWith(":")?(n[t.slice(1)]=o,!0):o===t});return o&&Object.assign(r,n),o}var a=e();const h=()=>{const t=r(a);if(!t)throw new Error("Hooks should be used as children of <Router>");return t},c=()=>{const[t,e]=h();return[t.path,(r,n)=>e({...t,path:r},n)]},p=t=>{const[e,r]=h(),n=e.query,o=(t,n)=>r({...e,query:t},n);return t?[n[t],(e,r)=>o({...n,[t]:e},r)]:[n,o]},l=()=>{const[t,e]=h();return[t.hash,(r,n)=>e({...t,hash:r},n)]},u=t=>{const[e]=c(),r={};return i(t,e,r),r},d=({path:e="*",exact:r=!0,component:n,render:o,children:s})=>{const[a,c]=h(),p={};if(!i(e,a,p))return null;if(n){const e=n;return t.createElement(e,p)}if(o)return o(p);if(s)return s;throw new Error("Route needs the prop `component`, `render` or `children`")},f=({path:t="*",to:e})=>{const[r,n]=h();return o(()=>{i(t,r)&&n(e)},[]),null},y=({children:t})=>{const[e]=h();if(!t)return null;Array.isArray(t)||(t=[t]);if([...t].find(({props:t})=>!t.path&&!t.to))throw new Error("<Switch> only accepts <Route> or <Redirect> as children");return t.find(({props:t})=>i(t.path||"*",e))};export default({children:e})=>{const[r,i]=n(s(window.location.href)),h=(t,e={mode:"push"})=>{"string"==typeof t&&(t=s(t));const r=(({path:t,query:e,hash:r}={})=>{let n=t||"/";return e&&Object.keys(e).length&&(n+="?",n+=Object.entries(e).map(([t,e])=>t+"="+encodeURIComponent(e)).join("&")),r&&(n+="#"+r),n})(t);if(!["push","replace"].includes(e.mode))throw new Error(`Unrecognized mode "${e.mode}"`);"replace"===e.mode?history.replaceState({},null,r):history.pushState({},null,r),i(t)};return o(()=>{window.onpopstate=t=>i(s(window.location.href));const t=t=>{const e=t.target.closest("a");if(!e)return;const r=e.getAttribute("href");r&&(/^https?:\/\//.test(r)||null===e.getAttribute("target")&&(t.preventDefault(),h(r)))};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[]),t.createElement(a.Provider,{value:[r,h]},e)};export{a as Context,f as Redirect,d as Route,y as Switch,l as useHash,u as useParams,c as usePath,p as useQuery,h as useUrl};
