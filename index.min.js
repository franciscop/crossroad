import e,{createContext as t,useContext as r,useState as n,useEffect as o}from"react";const i=e=>{if("string"!=typeof e)return e;const t={},r=new URL(e,"http://localhost:3000/");var n;(t.path=r.pathname.replace(/\/$/,"")||"/",r.hash)&&(t.hash=null===(n=r.hash)||void 0===n?void 0:n.replace(/^#/,""));t.query={};for(const[e,n]of r.searchParams)t.query[e]=n;return t};function a(e,t,r={}){if(e=JSON.parse(JSON.stringify(i(e))),(t=JSON.parse(JSON.stringify(i(t)))).path.endsWith("/")&&(t.path=t.path.slice(0,-1)||"/"),e.path.endsWith("/")&&(e.path=e.path.slice(0,-1)||"/"),e.path.endsWith("*")){e.path=e.path.replace(/\/?\*/,"")||"/";const r=e.path.slice(1).split("/").filter(Boolean).length;t.path="/"+t.path.slice(1).split("/").slice(0,r).join("/")}if(Object.entries(e.query).length)for(let r in e.query){if(!(r in t.query))return!1;if(e.query[r]&&e.query[r]!==t.query[r])return!1}if(t.path===e.path)return!0;if(!e.path.includes(":"))return e.path===t.path;if(e.path.split("/").length!==t.path.split("/").length)return!1;const n={},o=e.path.split("/").every((e,r)=>{const o=t.path.split("/")[r];return e.startsWith(":")?(n[e.slice(1)]=o,!0):o===e});return o&&Object.assign(r,n),o}var s=t();const l=()=>{const e=r(s);if(!e)throw new Error("Hooks should be used as children of <Router>");return e},u=()=>{const[e,t]=l();return[e.path,(r,n)=>t({...e,path:r},n)]},p=e=>{const[t,r]=l(),n=t.query,o=(e,n)=>r({...t,query:e},n);return e?[n[e],(t,r)=>o({...n,[e]:t},r)]:[n,o]},c=()=>{const[e,t]=l();return[e.hash,(r,n)=>t({...e,hash:r},n)]},h=e=>{const t=r(s),[n]=u();if(e){const t={};return a(e,n,t),t}return t[0].params},d=({path:t="*",exact:n=!0,component:o,render:i,children:u})=>{const p=r(s),[c,h]=l(),d={};if(!a(t,c,d))return null;const f=[{...p[0],params:d},p[1]];if(o){const t=o;return e.createElement(s.Provider,{value:f},e.createElement(t,d))}if(i)return e.createElement(s.Provider,{value:f},i(d));if(u)return e.createElement(s.Provider,{value:f},u);throw new Error("Route needs the prop `component`, `render` or `children`")},f=({redirect:e,children:t})=>{const[r,n]=l(),i=(e=>e?Array.isArray(e)?[...e]:[e]:[])(t).find(e=>a(e.props.path||"*",r))||null;return o(()=>{e&&!i&&n(e)},[e,Boolean(i)]),i};export default({url:t,children:r})=>{const a="undefined"==typeof window?"/":window.location.href,[l,u]=n(i(t||a)),p=(e,t={mode:"push"})=>{"string"==typeof e&&(e=i(e));const r=(({path:e,query:t,hash:r}={})=>{let n=e||"/";return t&&Object.keys(t).length&&(n+="?",n+=Object.entries(t).filter(([e,t])=>t||""===t).map(([e,t])=>e+"="+encodeURIComponent(t)).join("&")),r&&(n+="#"+r),n})(e);if(!["push","replace"].includes(t.mode))throw new Error(`Unrecognized mode "${t.mode}"`);"replace"===t.mode?history.replaceState({},null,r):history.pushState({},null,r),u(e)};return o(()=>{const e=e=>u(i(window.location.href)),t=e=>{const t=(e=>{if(!e)return null;const t=e.getAttribute("href");return t?/^https?:\/\//.test(t)||null!==e.getAttribute("target")?null:t:null})(e.target.closest("a"));t&&(e.preventDefault(),p(t))};return"undefined"!=typeof window&&window.addEventListener("popstate",e),"undefined"!=typeof document&&document.addEventListener("click",t),()=>{"undefined"!=typeof window&&window.removeEventListener("popstate",e),"undefined"!=typeof document&&document.removeEventListener("click",t)}},[]),e.createElement(s.Provider,{value:[l,p]},r)};export{s as Context,d as Route,f as Switch,c as useHash,h as useParams,u as usePath,p as useQuery,l as useUrl};
