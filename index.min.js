import e,{createContext as t,useContext as r,useState as n,useEffect as o}from"react";const a=e=>{if("string"!=typeof e)return e;const t={},r=new URL(e,"https://example.com/");var n;(t.path=r.pathname.replace(/\/$/,"")||"/",r.hash)&&(t.hash=null===(n=r.hash)||void 0===n?void 0:n.replace(/^#/,""));t.query={};for(const[e,n]of r.searchParams)t.query[e]=n;return t};function s(e,t,r={}){if(e=JSON.parse(JSON.stringify(a(e))),(t=JSON.parse(JSON.stringify(a(t)))).path.endsWith("/")&&(t.path=t.path.slice(0,-1)||"/"),e.path.endsWith("/")&&(e.path=e.path.slice(0,-1)||"/"),e.path.endsWith("*")){e.path=e.path.replace(/\/?\*/,"")||"/";const r=e.path.slice(1).split("/").filter(Boolean).length;t.path="/"+t.path.slice(1).split("/").slice(0,r).join("/")}if(Object.entries(e.query).length)for(let r in e.query){if(!(r in t.query))return!1;if(e.query[r]&&e.query[r]!==t.query[r])return!1}if(t.path===e.path)return!0;if(!e.path.includes(":"))return e.path===t.path;if(e.path.split("/").length!==t.path.split("/").length)return!1;const n={},o=e.path.split("/").every((e,r)=>{const o=t.path.split("/")[r];return e.startsWith(":")?(n[e.slice(1)]=o,!0):o===e});return o&&Object.assign(r,n),o}var i=t();const l=()=>{const e=r(i);if(!e)throw new Error("Hooks should be used as children of <Router>");return e},h=()=>{const[e,t]=l();return[e.path,(r,n)=>t({...e,path:r},n)]},c=e=>{const[t,r]=l(),n=t.query,o=(e,n)=>r({...t,query:e},n);return e?[n[e],(t,r)=>o({...n,[e]:t},r)]:[n,o]},p=()=>{const[e,t]=l();return[e.hash,(r,n)=>t({...e,hash:r},n)]},u=e=>{const t=r(i),[n]=h();if(e){const t={};return s(e,n,t),t}return t[0].params},d=({path:t="*",exact:n=!0,component:o,render:a,children:h})=>{const c=r(i),[p,u]=l(),d={};if(!s(t,p,d))return null;const f=[{...c[0],params:d},c[1]];if(o){const t=o;return e.createElement(i.Provider,{value:f},e.createElement(t,d))}if(a)return e.createElement(i.Provider,{value:f},a(d));if(h)return e.createElement(i.Provider,{value:f},h);throw new Error("Route needs the prop `component`, `render` or `children`")},f=({redirect:e,children:t})=>{const[r,n]=l(),a=(e=>e?Array.isArray(e)?[...e]:[e]:[])(t).find(e=>s(e.props.path||"*",r))||null;return o(()=>{e&&!a&&n(e)},[e,Boolean(a)]),a};export default({children:t})=>{const[r,s]=n(a(window.location.href)),l=(e,t={mode:"push"})=>{"string"==typeof e&&(e=a(e));const r=(({path:e,query:t,hash:r}={})=>{let n=e||"/";return t&&Object.keys(t).length&&(n+="?",n+=Object.entries(t).filter(([e,t])=>t||""===t).map(([e,t])=>e+"="+encodeURIComponent(t)).join("&")),r&&(n+="#"+r),n})(e);if(!["push","replace"].includes(t.mode))throw new Error(`Unrecognized mode "${t.mode}"`);"replace"===t.mode?history.replaceState({},null,r):history.pushState({},null,r),s(e)};return o(()=>{const e=e=>s(a(window.location.href)),t=e=>{const t=(e=>{if(!e)return null;const t=e.getAttribute("href");return t?/^https?:\/\//.test(t)||null!==e.getAttribute("target")?null:t:null})(e.target.closest("a"));t&&(e.preventDefault(),l(t))};return window.addEventListener("popstate",e),document.addEventListener("click",t),()=>{window.removeEventListener("popstate",e),document.removeEventListener("click",t)}},[]),e.createElement(i.Provider,{value:[r,l]},t)};export{i as Context,d as Route,f as Switch,p as useHash,u as useParams,h as usePath,c as useQuery,l as useUrl};
