import t,{createContext as e,useContext as r,useState as n,useEffect as o}from"react";const s=t=>{if("string"!=typeof t)return t;const e={},r=new URL(t,"https://example.com/");var n;(e.path=r.pathname.replace(/\/$/,"")||"/",r.hash)&&(e.hash=null===(n=r.hash)||void 0===n?void 0:n.replace(/^#/,""));e.query={};for(const[t,n]of r.searchParams)e.query[t]=n;return e};function a(t,e,r={}){if(t=JSON.parse(JSON.stringify(s(t))),(e=JSON.parse(JSON.stringify(s(e)))).path.endsWith("/")&&(e.path=e.path.slice(0,-1)||"/"),t.path.endsWith("/")&&(t.path=t.path.slice(0,-1)||"/"),t.path.endsWith("*")){t.path=t.path.replace(/\/?\*/,"")||"/";const r=t.path.slice(1).split("/").filter(Boolean).length;e.path="/"+e.path.slice(1).split("/").slice(0,r).join("/")}if(Object.entries(t.query).length)for(let r in t.query){if(!(r in e.query))return!1;if(t.query[r]&&t.query[r]!==e.query[r])return!1}return e.path===t.path||(t.path.includes(":")?t.path.split("/").length===e.path.split("/").length&&t.path.split("/").every((t,n)=>{const o=e.path.split("/")[n];return t.startsWith(":")?(r[t.slice(1)]=o,!0):o===t}):t.path===e.path)}var h=e();const i=()=>{const t=r(h);if(!t)throw new Error("Hooks should be used as children of <Router>");return t},p=()=>{const[t,e]=i();return[t.path,(r,n)=>e({...t,path:r},n)]},c=t=>{const[e,r]=i(),n=e.query,o=(t,n)=>r({...e,query:t},n);return t?[n[t],(e,r)=>o({...n,[t]:e},r)]:[n,o]},l=()=>{const[t,e]=i();return[t.hash,(r,n)=>e({...t,hash:r},n)]},u=({path:e="*",exact:r=!0,component:n,render:o,children:s})=>{const[h,p]=i(),c={};if(!a(e,h,c))return null;if(n){const e=n;return t.createElement(e,c)}if(o)return o(c);if(s)return s;throw new Error("Route needs the prop `component`, `render` or `children`")},d=({path:t="*",to:e})=>{const[r,n]=i();return o(()=>{a(t,r)&&n(e)},[]),null},f=({children:t})=>{const[e]=i();if(!t)return null;Array.isArray(t)||(t=[t]);if([...t].find(({props:t})=>!t.path&&!t.to))throw new Error("<Switch> only accepts <Route> or <Redirect> as children");return t.find(({props:t})=>a(t.path||"*",e))};export default({children:e})=>{const[r,a]=n(s(window.location.href)),i=(t,e={mode:"push"})=>{"string"==typeof t&&(t=s(t));const r=(({path:t,query:e,hash:r}={})=>{let n=t||"/";return e&&Object.keys(e).length&&(n+="?",n+=Object.entries(e).map(([t,e])=>t+"="+encodeURIComponent(e)).join("&")),r&&(n+="#"+r),n})(t);if(!["push","replace"].includes(e.mode))throw new Error(`Unrecognized mode "${e.mode}"`);"replace"===e.mode?history.replaceState({},null,r):history.pushState({},null,r),a(t)};return o(()=>{window.onpopstate=t=>a(s(window.location.href));const t=t=>{const e=t.target.closest("a");if(!e)return;const r=e.getAttribute("href");r&&(/^https?:\/\//.test(r)||null===e.getAttribute("target")&&(t.preventDefault(),i(r)))};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[]),t.createElement(h.Provider,{value:[r,i]},e)};export{h as Context,d as Redirect,u as Route,f as Switch,l as useHash,p as usePath,c as useQuery,i as useUrl};
