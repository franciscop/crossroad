import t,{createContext as e,useState as r,useEffect as n,useContext as a}from"react";var i=e();const o=t=>{if("string"!=typeof t)return t;const e={},r=new URL(t,"http://localhost:3000/");e.path=r.pathname.replace(/\/$/,"")||"/",e.query={};for(const[t]of r.searchParams)e.query[t]=(n=r.searchParams.getAll(t)).length>1?n:n[0];var n;return r.hash&&(e.hash=r.hash.replace(/^#/,"")),e},s=t=>{if("string"==typeof t)return t;const{path:e,query:r={},hash:n}=t||{};let a=e||"/";const i=new URLSearchParams(Object.entries(r).filter(([t,e])=>e).map(([t,e])=>(Array.isArray(e)?e:[e]).map(e=>[t,e])).flat()).toString();return i&&(a+="?"+i),n&&(a+="#"+n),a};var l=()=>"undefined"==typeof window;function p(t,e,r={}){if(t=JSON.parse(JSON.stringify(o(t))),(e=JSON.parse(JSON.stringify(o(e)))).path=e.path.replace(/\/$/,"")||"/",t.path=t.path.replace(/\/$/,"")||"/",t.path.endsWith("*")){t.path=t.path.replace(/\/?\*/,"")||"/";const r=t.path.split("/").filter(Boolean).length;e.path="/"+e.path.slice(1).split("/").slice(0,r).join("/")}if(Object.entries(t.query).length)for(let r in t.query){if(!(r in e.query))return!1;if(t.query[r]&&t.query[r]!==e.query[r])return!1}if(!t.path.includes(":"))return t.path===e.path&&r;if(t.path.split("/").length!==e.path.split("/").length)return!1;const n={},a=t.path.split("/").every((t,a)=>{const i=e.path.split("/")[a];return t.startsWith(":")?(n[t.slice(1)]=i,r):i===t});return a&&Object.assign(r,n),a&&r}var h=({path:e="*",exact:r=!0,component:n,render:o,children:s})=>{const l=a(i),h=p(e,l[0]);if(!h)return null;if(n){const e=n;s=t.createElement(e,h)}else if(o)s=o(h);else if(!s)throw new Error("Route needs prop `component`, `render` or `children`");return t.createElement(i.Provider,{value:[{...l[0],params:h},...l.slice(1)]},s)},c=()=>{const t=a(i);if(!t)throw new Error("Wrap your App with <Router>");return t};var u=({redirect:t,children:e})=>{const[r,a]=c(),i=(t=>(Array.isArray(t)||(t=[t]),t.filter(t=>t&&t.props)))(e).find(t=>p(t.props.path||"*",r))||null;return n(()=>{t&&(i||("function"==typeof t&&(t=t(r)),a(s(t))))},[t,i]),i},f=()=>{const[t,e]=c();return[t.path,(r,n)=>e({...t,path:r},n)]},d=t=>{const[e,r]=c(),n=e.query,a=(t,n)=>r({...e,query:t},n);return t?[n[t],(e,r)=>{if(null===e){const{[t]:e,...i}=n;return a(i,r)}return a({...n,[t]:e},r)}]:[n,a]},y=()=>{const[t,e]=c();return[t.hash,(r,n)=>e({...t,hash:r},n)]},m=t=>{const e=a(i);return t?p(t,e[0].path)||{}:e[0].params};export default({url:e,children:a})=>{const p=e||(l()?"/":window.location.href),[h,c]=r(()=>o(p)),u=(t,{mode:e="push"}={})=>{if(!history[e+"State"])throw new Error(`Invalid mode "${e}"`);history[e+"State"]({},null,s(t)),c(o(t))};return n(()=>{if(l())return;const t=()=>c(o(window.location.href)),e=t=>{const e=(t=>{if(!t)return null;const e=t.getAttribute("href");return e?/^https?:\/\//.test(e)||null!==t.getAttribute("target")?null:e:null})(t.target.closest("a"));e&&(t.preventDefault(),u(e))};return window.addEventListener("popstate",t),document.addEventListener("click",e),()=>{window.removeEventListener("popstate",t),document.removeEventListener("click",e)}},[]),t.createElement(i.Provider,{value:[h,u]},a)};export{i as Context,h as Route,u as Switch,y as useHash,m as useParams,f as usePath,d as useQuery,c as useUrl};
